<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>نظام متابعة المؤشرات</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body { font-family: Arial, sans-serif; background:#f4f6f9; }
  .card { margin-bottom: 15px; }
</style>
</head>
<body>

<div class="container mt-4">
  <h3 class="text-center mb-4">نظام متابعة المؤشرات المدرسية</h3>

  <div class="card p-3">
    <label class="form-label">اسم المشرف</label>
    <input type="text" id="supervisor" class="form-control mb-2" placeholder="مثال: أبو محمد">

    <label class="form-label">اسم المؤشر</label>
    <input type="text" id="indicator" class="form-control mb-2" placeholder="مثال: متابعة خطط التشغيل">

    <label class="form-label">الحالة</label>
    <select id="status" class="form-control mb-2">
      <option>لم يبدأ</option>
      <option>جار التنفيذ</option>
      <option>تم التنفيذ</option>
    </select>

    <button class="btn btn-primary w-100" onclick="saveData()">حفظ</button>
  </div>

  <h5 class="mt-4">السجلات:</h5>
  <ul id="dataList" class="list-group"></ul>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCCLDwIpAic1SFDHlCt3xdaWBGvURakvEU",
    authDomain: "school-system-87d90.firebaseapp.com",
    projectId: "school-system-87d90",
    storageBucket: "school-system-87d90.firebasestorage.app",
    messagingSenderId: "324849105535",
    appId: "1:324849105535:web:9cc2d817a57db2b41b9d4a"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const dataRef = collection(db, "indicators");

  // حفظ سجل جديد
  window.saveData = async function () {
    const supervisor = document.getElementById("supervisor").value.trim();
    const indicator  = document.getElementById("indicator").value.trim();
    const status     = document.getElementById("status").value;

    if (!supervisor || !indicator) {
      alert("فضلاً أدخل اسم المشرف واسم المؤشر.");
      return;
    }

    await addDoc(dataRef, {
      supervisor,
      indicator,
      status,
      created: new Date()
    });

    document.getElementById("supervisor").value = "";
    document.getElementById("indicator").value  = "";
  };

  // عرض السجلات (الأحدث أولاً)
  const q = query(dataRef, orderBy("created", "desc"));

  onSnapshot(q, (snapshot) => {
    const list = document.getElementById("dataList");
    list.innerHTML = "";

    snapshot.forEach((doc) => {
      const d = doc.data();
      const li = document.createElement("li");
      li.className = "list-group-item";

      li.innerHTML = `
        <div><b>${escapeHtml(d.indicator ?? "")}</b> - ${escapeHtml(d.status ?? "")}</div>
        <small class="text-muted">${escapeHtml(d.supervisor ?? "")}</small>
      `;

      list.appendChild(li);
    });
  });

  // حماية بسيطة من إدخال HTML
  function escapeHtml(str) {
    return String(str)
      .replaceAll("&", "&amp;")
      .replaceAll("<", "&lt;")
      .replaceAll(">", "&gt;")
      .replaceAll('"', "&quot;")
      .replaceAll("'", "&#039;");
  }
</script>

</body>
</html>
